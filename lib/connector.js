var sentinel=require("redis-sentinel"),_options={},_sentinel=null,initOptions=function(a,b){b||(b="master");a||(a={},a.dbIdx||(a.db=0),a.role||(a.role=b));for(var h in _options.redis)a[h]=_options.redis[h];return a};module.exports.config=function(a){a&&(_options=a);_sentinel=sentinel.Sentinel(_options.endpoints)};
var getClient=module.exports.getClient=function(a,b,h){for(var d=null,f=null,k=null,e=null,g=null,c=0;c<arguments.length;c++)"string"===typeof arguments[c]?d=arguments[c]:"function"===typeof arguments[c]?f=arguments[c]:"object"===typeof arguments[c]&&(k=arguments[c]);try{e=initOptions(k,d),g=_sentinel.createClient(_options.masterName,e),e.auth_pass&&g.auth(e.auth_pass)}catch(l){f(l)}f(null,g)};
module.exports.get=function(a,b,h){getClient("master",h,function(d,f){if(d&&"OK"!==d)return b(d);f.get(a,function(a,e){f.quit();b(null,e)})})};
module.exports.set=function(a,b,h,d,f){var k=0,e=null,g=null;redisConnect=null;options=initOptions(g);idx=2;console.log("%% redis-set ["+a+"]");for("object"===typeof b&&(b=JSON.stringify(b));idx<arguments.length;idx++)"number"===typeof arguments[idx]?k=arguments[idx]:"function"===typeof arguments[idx]?e=arguments[idx]:"object"===typeof arguments[idx]&&(g=arguments[idx]);getClient("master",g,function(c,d){if(c)return redis(c);d.set(a,b,function(b,c){d.quit();if(b&&"OK"!==c){if(e)return redis(b);throw b;
}k&&d.expire(a,k);e&&e(b)})})};